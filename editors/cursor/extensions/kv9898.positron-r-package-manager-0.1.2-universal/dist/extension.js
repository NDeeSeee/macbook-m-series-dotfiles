(()=>{var e={75:function(e,t,n){"use strict";var r,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),i=0;i<n.length;i++)"default"!==n[i]&&a(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.refreshPackages=async function(e){if(!await l.runtime.getRegisteredRuntimes().then((e=>e.some((e=>"r"===e.languageId)))))throw new Error(s.l10n.t("No R runtime available."));const t=g.join(u.tmpdir(),`r_packages_${Date.now()}.json`),n=`\n    (function() {\n      jsonlite::write_json(\n        {\n          do.call(rbind, lapply(.libPaths(), function(lib) {\n            if (!dir.exists(lib)) return(NULL)\n\n            pkgs <- installed.packages(lib.loc = lib)[, c("Package", "Version"), drop = FALSE]\n            if (nrow(pkgs) == 0) return(NULL)\n\n            titles <- vapply(pkgs[, "Package"], function(pkg) {\n              tryCatch(packageDescription(pkg, fields = "Title"), error = function(e) NA_character_)\n            }, character(1))\n\n            loaded_paths <- vapply(loadedNamespaces(), function(pkg) {\n              tryCatch(dirname(getNamespaceInfo(pkg, "path")), error = function(e) NA_character_)\n            }, character(1), USE.NAMES = TRUE)\n\n            df <- data.frame(\n              Package = pkgs[, "Package"],\n              Version = pkgs[, "Version"],\n              LibPath = lib,\n              LocationType = if (normalizePath(lib, winslash = "/", mustWork = FALSE) %in%\n                                   normalizePath(.Library, winslash = "/", mustWork = FALSE)) "System" else "User",\n              Title = titles,\n              Loaded = pkgs[, "Package"] %in% names(loaded_paths) & loaded_paths[pkgs[, "Package"]] == lib,\n              stringsAsFactors = FALSE\n            )\n\n            df\n          })) -> result\n\n          if (is.null(result)) list() else result[order(result$Package, result$LibPath), ]\n        },\n        path = "${t.replace(/\\/g,"/")}",\n        auto_unbox = TRUE\n      )\n    })()\n  `.trim(),r=(0,f.getObserver)("Error refreshing packages: {0}");try{await l.runtime.executeCode("r",n,!1,void 0,l.RuntimeCodeExecutionMode.Silent,void 0,r),await(0,f.waitForFile)(t);const a=c.readFileSync(t,"utf-8"),o=JSON.parse(a);try{c.unlinkSync(t)}catch(e){console.warn(s.l10n.t("[Positron] Failed to delete temp file: "),e)}const i=o.map((e=>({name:e.Package,version:e.Version,libpath:e.LibPath,locationtype:e.LocationType,title:e.Title,loaded:e.Loaded})));e.refresh(i)}catch(e){throw s.window.showErrorMessage(s.l10n.t("Failed to refresh R packages: {0}",e instanceof Error?e.message:String(e))),e}};const s=i(n(398)),l=i(n(346)),c=i(n(896)),u=i(n(857)),g=i(n(928)),f=n(185)},185:function(e,t,n){"use strict";var r,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),i=0;i<n.length;i++)"default"!==n[i]&&a(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.stripAnsi=u,t.getFilterRedundant=function(){return s.workspace.getConfiguration("positron-r-package-manager",s.Uri.file(s.workspace.workspaceFolders?.[0].uri.fsPath??"")).get("filterOutdatedIfUpToDateElsewhere",!0)},t.getShowRIcon=function(){return s.workspace.getConfiguration("positron-r-package-manager").get("showRIcon",!1)},t.getObserver=g,t._installpackages=f,t.waitForFile=async function(e,t=1e3){return new Promise(((n,r)=>{const a=Date.now(),o=setInterval((()=>{if(c.existsSync(e))clearInterval(o),n();else if(Date.now()-a>t){clearInterval(o);const t=new Error(s.l10n.t("Timeout waiting for file: {0}",e));s.window.showErrorMessage(t.message),r(t)}}),100)}))};const s=i(n(398)),l=i(n(346)),c=i(n(896));function u(e){return e.replace(/\x1b\[[0-9;]*m/g,"")}function g(e,t=[],n){return{onFailed:r=>{!function(r){const a=[...t,r];if(/jsonlite/i.test(r))s.window.showWarningMessage(s.l10n.t("The 'jsonlite' package appears to be missing. Would you like to install it?"),s.l10n.t("Install")).then((e=>{e===s.l10n.t("Install")&&f('"jsonlite"')}));else if(/devtools/i.test(r))s.window.showWarningMessage(s.l10n.t("The 'devtools' package appears to be missing. Would you like to install it?"),s.l10n.t("Install")).then((e=>{e===s.l10n.t("Install")&&f('"devtools"')}));else if(/readRDS/i.test(r)){const e=s.l10n.t("Restart R");s.window.showWarningMessage(s.l10n.t("A readRDS() error was encountered. Please restart R to continue."),e).then((t=>{t===e&&l.runtime.getForegroundSession().then((e=>{e?.metadata.sessionId.startsWith("r-")?l.runtime.restartSession(e?.metadata.sessionId):s.window.showWarningMessage(s.l10n.t("No active R session found in the foreground. Please restart R manually."))}))}))}else s.window.showErrorMessage(s.l10n.t(e,...a)),n&&n()}(u(r.message))}}}function f(e,t){const n=`install.packages(c(${e})${t?`, lib = "${t.replace(/\\/g,"/")}"`:""})`,r=g("Error while installing {0}: {1}",[e]);l.runtime.executeCode("r",n,!0,void 0,l.RuntimeCodeExecutionMode.Interactive,void 0,r).then((()=>{s.commands.executeCommand("positron-r-package-manager.refreshPackages")}))}},217:function(e,t,n){(function(){var e,r,a,o,i,s,l,c,u,g;g=n(387),a=g.isMatch,o=g.isWordStart,u=g.scoreConsecutives,c=g.scoreCharacter,l=g.scoreAcronyms,t.match=i=function(t,n,o){var i,l,c,u,g,f;return i=o.allowErrors,g=o.preparedQuery,u=o.pathSeparator,i||a(t,g.core_lw,g.core_up)?(f=t.toLowerCase(),0===(c=r(t,f,g)).length||t.indexOf(u)>-1&&(l=e(t,f,g,u),c=s(c,l)),c):[]},t.wrap=function(e,t,n){var r,a,o,s,l,c,u,g,f;if(null!=n.wrap&&(c=(f=n.wrap).tagClass,g=f.tagOpen,u=f.tagClose),null==c&&(c="highlight"),null==g&&(g='<strong class="'+c+'">'),null==u&&(u="</strong>"),e===t)return g+e+u;if(0===(o=i(e,0,n)).length)return e;for(s="",r=-1,l=0;++r<o.length;){for((a=o[r])>l&&(s+=e.substring(l,a),l=a);++r<o.length;){if(o[r]!==a+1){r--;break}a++}++a>l&&(s+=g,s+=e.substring(l,a),s+=u,l=a)}return l<=e.length-1&&(s+=e.substring(l)),s},e=function(e,t,n,a){var o,i,s;for(s=e.length-1;e[s]===a;)s--;if(-1===(o=e.lastIndexOf(a,s)))return[];for(i=n.depth;i-- >0;)if(-1===(o=e.lastIndexOf(a,o-1)))return[];return o++,s++,r(e.slice(o,s),t.slice(o,s),n,o)},s=function(e,t){var n,r,a,o,i,s,l;if(i=e.length,0===(s=t.length))return e.slice();if(0===i)return t.slice();for(a=-1,r=t[o=0],l=[];++a<i;){for(n=e[a];r<=n&&++o<s;)r<n&&l.push(r),r=t[o];l.push(n)}for(;o<s;)l.push(t[o++]);return l},r=function(e,t,n,r){var a,i,s,g,f,d,p,h,m,w,b,v,k,y,P,_,O,x,C,S,j,M;for(null==r&&(r=0),y=n.query,P=n.query_lw,m=e.length,v=y.length,a=l(e,t,y,P).score,x=new Array(v),f=new Array(v),M=new Array(m*v),k=-1,h=-1;++h<v;)x[h]=0,f[h]=0;for(p=-1;++p<m;)for(_=0,C=0,g=0,S=t[p],h=-1;++h<v;)d=0,i=0,O=C,P[h]===S&&(j=o(p,e,t),d=g>0?g:u(e,t,y,P,p,h,j),i=O+c(p,h,j,a,d)),C=x[h],g=f[h],_>C?b=2:(_=C,b=1),i>_?(_=i,b=3):d=0,x[h]=_,f[h]=d,M[++k]=_>0?b:0;for(k=(p=m-1)*v+(h=v-1),s=!0,w=[];s&&p>=0&&h>=0;)switch(M[k]){case 1:p--,k-=v;break;case 2:h--,k--;break;case 3:w.push(p+r),h--,p--,k-=v+1;break;default:s=!1}return w.reverse(),w}}).call(this)},264:function(e,t,n){"use strict";var r,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),i=0;i<n.length;i++)"default"!==n[i]&&a(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.RPackageItem=t.SidebarProvider=void 0;const s=i(n(398)),l=i(n(346)),c=i(n(928)),u=n(730),g=n(75),f=n(185);t.SidebarProvider=class{filterText="";showOnlyLoadedPackages=!1;_onDidChangeTreeData=new s.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;packages=[];refresh(e){this.packages=e,this._onDidChangeTreeData.fire()}getTreeItem(e){return e}getChildren(){let e=this.packages;if(this.filterText.trim()){const t=this.packages.map((e=>({pkg:e,query:`${e.name} ${e.title}`})));e=(0,u.filter)(t,this.filterText.trim(),{key:"query"}).map((e=>e.pkg))}return this.showOnlyLoadedPackages&&(e=e.filter((e=>e.loaded))),0===e.length?Promise.resolve([new p(s.l10n.t("No R package information available yet.")),new p(s.l10n.t("Try to refresh after R starts or clear search."))]):Promise.resolve(e.map((e=>new d(e))))}handleCheckboxChange(e,t){const n=t===s.TreeItemCheckboxState.Checked?`library(${JSON.stringify(e.pkg.name)}, lib.loc = ${JSON.stringify(e.pkg.libpath)})`:`detach("package:${e.pkg.name}", unload = TRUE)`;l.runtime.executeCode("r",n,!0,void 0,l.RuntimeCodeExecutionMode.Interactive).then((()=>{(0,g.refreshPackages)(this)}))}getFilter(){return this.filterText||""}setFilter(e){this.filterText=e,(0,g.refreshPackages)(this)}getPackages(){return this.packages}toggleShowOnlyLoadedPackages(){this.showOnlyLoadedPackages=!this.showOnlyLoadedPackages,this._onDidChangeTreeData.fire()}};class d extends s.TreeItem{pkg;constructor(e){super(e.name,s.TreeItemCollapsibleState.None),this.pkg=e,this.description=`${e.version} (${e.locationtype})`,this.tooltip=`${e.title}\n(${e.libpath})`,this.contextValue="rPackage",(0,f.getShowRIcon)()&&(this.iconPath={light:s.Uri.file(c.join(__dirname,"..","resources","r_logo.svg")),dark:s.Uri.file(c.join(__dirname,"..","resources","r_logo.svg"))}),this.checkboxState=e.loaded?s.TreeItemCheckboxState.Checked:s.TreeItemCheckboxState.Unchecked,this.command={command:"positron-r-package-manager.openHelp",title:s.l10n.t("Open Package Help"),arguments:[e.name]}}}t.RPackageItem=d;class p extends s.TreeItem{constructor(e){super(e,s.TreeItemCollapsibleState.None),this.iconPath=new s.ThemeIcon("info"),this.contextValue="placeholder"}}},265:function(e,t,n){"use strict";var r,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),i=0;i<n.length;i++)"default"!==n[i]&&a(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){const t=new u.SidebarProvider,n=(0,d.getChangeForegroundEvent)();e.subscriptions.push(n),console.log('Congratulations, your extension "positron-r-package-manager" sees its sidebar refreshed!'),s.commands.registerCommand("positron-r-package-manager.refreshPackages",(async()=>{await l.runtime.getActiveSessions().then((e=>e.some((e=>"r"===e.runtimeMetadata.languageId))))?await(0,c.refreshPackages)(t):s.window.showWarningMessage(s.l10n.t("No active R console session available. Please start one."))}));const r=s.window.createTreeView("rPackageView",{treeDataProvider:t,showCollapseAll:!1,canSelectMany:!1});r.onDidChangeCheckboxState((e=>{for(const[n,r]of e.items)t.handleCheckboxChange(n,r)})),r.onDidChangeVisibility((async e=>{e.visible&&await l.runtime.getRegisteredRuntimes().then((e=>e.some((e=>"r"===e.languageId))))&&(0,c.refreshPackages)(t)})),e.subscriptions.push(s.commands.registerCommand("positron-r-package-manager.openHelp",(e=>{const t=`help(package = "${e}")`;l.runtime.executeCode("r",t,!1,void 0,l.RuntimeCodeExecutionMode.Silent)})),s.commands.registerCommand("positron-r-package-manager.searchPackages",(async()=>{const e=await s.window.showInputBox({prompt:s.l10n.t("Search R packages — press Esc to clear filter, Enter to apply"),value:t.getFilter(),placeHolder:s.l10n.t("e.g. plot")});t.setFilter(e??"")})),s.commands.registerCommand("positron-r-package-manager.installPackages",(()=>{(0,g.installPackages)()})),s.commands.registerCommand("positron-r-package-manager.uninstallPackage",(e=>{(0,f.uninstallPackage)(e,t)})),s.commands.registerCommand("positron-r-package-manager.updatePackages",(()=>{(0,f.updatePackages)(t)})),s.commands.registerCommand("positron-r-package-manager.filterLoadedPackages",(()=>{t.toggleShowOnlyLoadedPackages()})))},t.deactivate=function(){};const s=i(n(398)),l=i(n(346)),c=n(75),u=n(264),g=n(631),f=n(916),d=n(795)},303:function(e,t,n){(function(){var t,r,a,o,i,s,l;l=n(516),r=l.countDir,o=l.getExtension,e.exports=function(e,n){var i,l,c;if(i=(c=null!=n?n:{}).optCharRegEx,l=c.pathSeparator,!e||!e.length)return null;this.query=e,this.query_lw=e.toLowerCase(),this.core=t(e,i),this.core_lw=this.core.toLowerCase(),this.core_up=s(this.core),this.depth=r(e,e.length,l),this.ext=o(this.query_lw),this.charCodes=a(this.query_lw)},i=/[ _\-:\/\\]/g,t=function(e,t){return null==t&&(t=i),e.replace(t,"")},s=function(e){var t,n,r;for(t="",n=0,r=e.length;n<r;n++)t+=e[n].toUpperCase()[0];return t},a=function(e){var t,n,r;for(r=e.length,n=-1,t=[];++n<r;)t[e.charCodeAt(n)]=!0;return t}}).call(this)},346:e=>{"use strict";e.exports=require("positron")},387:function(e,t){(function(){var e,n,r,a,o,i,s,l,c,u,g,f,d,p,h,m;t.score=function(e,t,r){var a,i,s;return a=r.preparedQuery,r.allowErrors||o(e,a.core_lw,a.core_up)?(s=e.toLowerCase(),i=n(e,s,a),Math.ceil(i)):0},t.isMatch=o=function(e,t,n){var r,a,o,i,s,l,c;if(o=e.length,i=t.length,!o||i>o)return!1;for(r=-1,a=-1;++a<i;){for(s=t.charCodeAt(a),l=n.charCodeAt(a);++r<o&&(c=e.charCodeAt(r))!==s&&c!==l;);if(r===o)return!1}return!0},t.computeScore=n=function(e,t,n){var r,a,o,i,s,p,h,w,b,v,k,y,P,_,O,x,C,S,j,M,E,I,R,L;if(O=n.query,x=n.query_lw,v=e.length,P=O.length,a=(r=c(e,t,O,x)).score,r.count===P)return f(P,v,a,r.pos);if((_=t.indexOf(x))>-1)return d(e,t,O,x,_,P,v);for(M=new Array(P),s=new Array(P),L=m(P,v),y=k=Math.ceil(.75*P)+5,h=!0,b=-1;++b<P;)M[b]=0,s[b]=0;for(w=-1;++w<v;)if(!(I=t[w]).charCodeAt(0)in n.charCodes){if(h){for(b=-1;++b<P;)s[b]=0;h=!1}}else for(S=0,j=0,i=0,C=!0,h=!0,b=-1;++b<P;){if((E=M[b])>S&&(S=E),p=0,x[b]===I)if(R=l(w,e,t),p=i>0?i:g(e,t,O,x,w,b,R),(o=j+u(w,b,R,a,p))>S)S=o,y=k;else{if(C&&--y<=0)return Math.max(S,M[P-1])*L;C=!1}j=E,i=s[b],s[b]=p,M[b]=S}return(S=M[P-1])*L},t.isWordStart=l=function(e,t,n){var r,a;return 0===e||(r=t[e],a=t[e-1],i(a)||r!==n[e]&&a===n[e-1])},t.isWordEnd=s=function(e,t,n,r){var a,o;return e===r-1||(a=t[e],o=t[e+1],i(o)||a===n[e]&&o!==n[e+1])},i=function(e){return" "===e||"."===e||"-"===e||"_"===e||"/"===e||"\\"===e},h=function(e){var t;return e<20?100+(t=20-e)*t:Math.max(120-e,0)},t.scoreSize=m=function(e,t){return 150/(150+Math.abs(t-e))},f=function(e,t,n,r){return 2*e*(150*n+h(r))*m(e,t)},t.scorePattern=p=function(e,t,n,r,a){var o,i;return i=e,o=6,n===e&&(o+=2),r&&(o+=3),a&&(o+=1),e===t&&(r&&(i+=n===t?2:1),a&&(o+=1)),n+i*(i+o)},t.scoreCharacter=u=function(e,t,n,r,a){var o;return o=h(e),n?o+150*((r>a?r:a)+10):o+150*a},t.scoreConsecutives=g=function(e,t,n,r,a,o,i){var l,c,u,g,f,d,h;for(l=(u=(c=e.length)-a)<(f=(g=n.length)-o)?u:f,d=0,h=0,n[o]===e[a]&&d++;++h<l&&r[++o]===t[++a];)n[o]===e[a]&&d++;return h<l&&a--,1===h?1+2*d:p(h,g,d,i,s(a,e,t,c))},t.scoreExactMatch=d=function(e,t,n,r,a,o,i){var c,u,g,d,h;for((h=l(a,e,t))||(g=t.indexOf(r,a+1))>-1&&(h=l(g,e,t))&&(a=g),u=-1,d=0;++u<o;)n[a+u]===e[u]&&d++;return c=s(a+o-1,e,t,i),f(o,i,p(o,o,d,h,c),a)},r=new(e=function(e,t,n){this.score=e,this.pos=t,this.count=n})(0,.1,0),t.scoreAcronyms=c=function(t,n,o,s){var c,u,g,f,d,h,m,w,b,v,k;if(d=t.length,h=o.length,!(d>1&&h>1))return r;for(c=0,v=0,k=0,w=0,g=-1,f=-1;++f<h;){if(m=s[f],i(m)){if((g=n.indexOf(m,g+1))>-1){v++;continue}break}for(;++g<d;)if(m===n[g]&&l(g,t,n)){o[f]===t[g]&&w++,k+=g,c++;break}if(g===d)break}return c<2?r:(u=c===h&&a(t,n,o,c),b=p(c,h,w,!0,u),new e(b,k/c,c+v))},a=function(e,t,n,r){var a,o,i;if(a=0,(i=e.length)>12*n.length)return!1;for(o=-1;++o<i;)if(l(o,e,t)&&++a>r)return!1;return!0}}).call(this)},398:e=>{"use strict";e.exports=require("vscode")},465:function(e,t,n){(function(){var t,r,a,o;a=n(387),t=n(516),n(303),r=function(e){return e.candidate},o=function(e,t){return t.score-e.score},e.exports=function(e,n,i){var s,l,c,u,g,f,d,p,h,m,w,b,v;for(p=[],c=i.key,g=i.maxResults,u=i.maxInners,w=i.usePathScoring,h=null!=u&&u>0?u:e.length+1,s=null!=c,d=w?t:a,b=0,v=e.length;b<v&&(l=e[b],!((m=s?l[c]:l)&&(f=d.score(m,n,i))>0)||(p.push({candidate:l,score:f}),--h));b++);return p.sort(o),e=p.map(r),null!=g&&(e=e.slice(0,g)),e}}).call(this)},516:function(e,t,n){(function(){var e,r,a,o,i,s,l;l=n(387),o=l.isMatch,e=l.computeScore,s=l.scoreSize,t.score=function(t,n,r){var a,s,l;return a=r.preparedQuery,r.allowErrors||o(t,a.core_lw,a.core_up)?(l=t.toLowerCase(),s=e(t,l,a),s=i(t,l,s,r),Math.ceil(s)):0},i=function(t,n,o,i){var l,c,u,g,f,d,p,h,m,w;if(0===o)return 0;for(m=i.preparedQuery,w=i.useExtensionBonus,h=i.pathSeparator,f=t.length-1;t[f]===h;)f--;if(p=f-(u=t.lastIndexOf(h,f)),d=1,w&&(o*=d+=a(n,m.ext,u,f,2)),-1===u)return o;for(g=m.depth;u>-1&&g-- >0;)u=t.lastIndexOf(h,u-1);return c=-1===u?o:d*e(t.slice(u+1,f+1),n.slice(u+1,f+1),m),(l=10/(20+r(t,f+1,h)))*c+(1-l)*o*s(0,2.5*p)},t.countDir=r=function(e,t,n){var r,a;if(t<1)return 0;for(r=0,a=-1;++a<t&&e[a]===n;);for(;++a<t;)if(e[a]===n)for(r++;++a<t&&e[a]===n;);return r},t.getExtension=function(e){var t;return(t=e.lastIndexOf("."))<0?"":e.substr(t+1)},a=function(e,t,n,r,o){var i,s,l,c;if(!t.length)return 0;if(!((c=e.lastIndexOf(".",r))>n))return 0;for((i=r-c)<(l=t.length)&&(l=i,i=t.length),c++,s=-1;++s<l&&e[c+s]===t[s];);return 0===s&&o>0?.9*a(e,t,n,c-2,o-1):s/i}}).call(this)},631:function(e,t,n){"use strict";var r,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),i=0;i<n.length;i++)"default"!==n[i]&&a(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.installPackages=async function(){const e=await d();await p(e[0])},t.changeLibPath=h;const s=i(n(398)),l=i(n(346)),c=i(n(896)),u=i(n(857)),g=i(n(928)),f=n(185);async function d(){const e=g.join(u.tmpdir(),`r_libPaths_${Date.now()}.json`),t=`\n    jsonlite::write_json(\n      .libPaths(),\n      path = "${e.replace(/\\/g,"/")}",\n      auto_unbox = FALSE\n    )\n    `.trim(),n=(0,f.getObserver)("Error while fetching library paths: {0}");await l.runtime.executeCode("r",t,!1,void 0,l.RuntimeCodeExecutionMode.Silent,void 0,n);try{const t=c.readFileSync(e,"utf-8").trim(),n=JSON.parse(t);try{c.unlinkSync(e)}catch(e){console.warn(s.l10n.t("[Positron] Failed to delete temp file: "),e)}return n}catch(e){return s.window.showErrorMessage(s.l10n.t("Failed to read library paths from R output: {0}",e instanceof Error?e.message:String(e))),[]}}async function p(e){const t=[{label:s.l10n.t("Install from CRAN (Recommended)"),value:"cran"},{label:s.l10n.t("Install from GitHub"),value:"github"},{label:s.l10n.t("Install from local archive (.tar.gz or .zip)"),value:"local"},{label:s.l10n.t("Install to another directory (current: {0})",e),value:"customLib"}],n=await s.window.showQuickPick(t,{title:s.l10n.t("Select installation method"),placeHolder:s.l10n.t("Where would you like to install packages from?"),ignoreFocusOut:!0});switch(n?.value){case"cran":await async function(e){const t=await s.window.showInputBox({title:s.l10n.t("Install R Packages"),prompt:s.l10n.t("Packages (separate multiple with space or comma)"),placeHolder:s.l10n.t("e.g. ggplot2 dplyr tidyr"),ignoreFocusOut:!0});if(!t?.trim())return;const n=t.split(/[\s,]+/).filter((e=>e.length)).map((e=>`"${e}"`)).join(", ");(0,f._installpackages)(n,e)}(e);break;case"github":await async function(e){const t=await s.window.showInputBox({title:s.l10n.t(s.l10n.t("Install from GitHub")),prompt:s.l10n.t("Enter GitHub repo (e.g., tidyverse/ggplot2)"),ignoreFocusOut:!0});if(!t?.trim())return;const n=e?`withr::with_libpaths("${e.replace(/\\/g,"/")}", devtools::install_github("${t}"))`:`devtools::install_github("${t}")`,r=(0,f.getObserver)("Error while installing from {0}: {1}",[t]);return await l.runtime.executeCode("r",n,!0,void 0,l.RuntimeCodeExecutionMode.Interactive,void 0,r),void s.commands.executeCommand("positron-r-package-manager.refreshPackages")}(e);break;case"local":await async function(e){const t=await s.window.showOpenDialog({filters:{"R Packages":["tar.gz","zip"]},canSelectMany:!1,openLabel:s.l10n.t("Install package")});if(!t||!t[0])return;const n=t[0].fsPath.replace(/\\/g,"/"),r=e?`install.packages("${n}", repos = NULL, type = "source", lib = "${e}")`:`install.packages("${n}", repos = NULL, type = "source")`;return await l.runtime.executeCode("r",r,!0,void 0,l.RuntimeCodeExecutionMode.Interactive),void s.commands.executeCommand("positron-r-package-manager.refreshPackages")}(e);break;case"customLib":await h()}}async function h(){const e=await d(),t=s.window.createQuickPick();t.title=s.l10n.t("Select Library Path"),t.placeholder=s.l10n.t("Choose an existing path or type a new one"),t.ignoreFocusOut=!0;const n=[...e.map((e=>({label:e,description:s.l10n.t("Existing library path")}))),{id:"browse",label:s.l10n.t("📁 Browse for a new library path..."),description:s.l10n.t("Select a custom directory")}];t.items=n,t.show(),t.onDidAccept((async()=>{const e=t.value.trim().replace(/\\/g,"/");let n;const r=t.selectedItems[0];if("browse"===r?.id){const e=await s.window.showOpenDialog({canSelectFolders:!0,canSelectMany:!1,openLabel:s.l10n.t("Use as Library Path")});e?.length&&(n=e[0].fsPath.replace(/\\/g,"/"))}else if(r)n=r.label;else if(e)if(c.existsSync(e))n=e.trim();else try{c.mkdirSync(e,{recursive:!0}),n=e}catch(e){s.window.showErrorMessage(s.l10n.t("Failed to create directory: {0}",String(e)))}t.hide(),n&&await p(n)}))}},730:function(e,t,n){(function(){var t,r,a,o,i,s,l,c;a=n(465),o=n(217),c=n(387),s=n(516),t=n(303),l=null,r="win32"===("undefined"!=typeof process&&null!==process?process.platform:void 0)?"\\":"/",e.exports={filter:function(e,t,n){return null==n&&(n={}),(null!=t?t.length:void 0)&&(null!=e?e.length:void 0)?(n=i(n,t),a(e,t,n)):[]},score:function(e,t,n){return null==n&&(n={}),(null!=e?e.length:void 0)&&(null!=t?t.length:void 0)?(n=i(n,t)).usePathScoring?s.score(e,t,n):c.score(e,t,n):0},match:function(e,t,n){var r;return null==n&&(n={}),e&&t?e===t?function(){r=[];for(var t=0,n=e.length;0<=n?t<n:t>n;0<=n?t++:t--)r.push(t);return r}.apply(this):(n=i(n,t),o.match(e,t,n)):[]},wrap:function(e,t,n){return null==n&&(n={}),e&&t?(n=i(n,t),o.wrap(e,t,n)):[]},prepareQuery:function(e,t){return null==t&&(t={}),(t=i(t,e)).preparedQuery}},i=function(e,n){return null==e.allowErrors&&(e.allowErrors=!1),null==e.usePathScoring&&(e.usePathScoring=!0),null==e.useExtensionBonus&&(e.useExtensionBonus=!1),null==e.pathSeparator&&(e.pathSeparator=r),null==e.optCharRegEx&&(e.optCharRegEx=null),null==e.wrap&&(e.wrap=null),null==e.preparedQuery&&(e.preparedQuery=l&&l.query===n?l:l=new t(n,e)),e}}).call(this)},795:function(e,t,n){"use strict";var r,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),i=0;i<n.length;i++)"default"!==n[i]&&a(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.getChangeForegroundEvent=function(){return l.runtime.onDidChangeForegroundSession((e=>{e?.startsWith("r-")&&s.commands.executeCommand("positron-r-package-manager.refreshPackages")}))};const s=i(n(398)),l=i(n(346))},857:e=>{"use strict";e.exports=require("os")},896:e=>{"use strict";e.exports=require("fs")},916:function(e,t,n){"use strict";var r,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),i=0;i<n.length;i++)"default"!==n[i]&&a(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.uninstallPackage=async function(e,t){if(await(0,f.refreshPackages)(t),!e){const n=t.getPackages?.();if(!n||0===n.length)return void s.window.showInformationMessage(s.l10n.t("No R packages available to uninstall."));const r=await s.window.showQuickPick(n.map((e=>({label:`${e.name} ${e.version} (${e.locationtype})`,description:`(${e.libpath}) ${e.title}`,pkg:e}))),{title:s.l10n.t("Select a package to uninstall"),placeHolder:s.l10n.t("Please click a package to uninstall"),ignoreFocusOut:!0});if(!r)return;e={pkg:r.pkg}}if(await s.window.showWarningMessage(s.l10n.t("Uninstall R package {0} {1} ({2})?",e.pkg.name,e.pkg.version,e.pkg.locationtype),{modal:!0},s.l10n.t("Yes"))!==s.l10n.t("Yes"))return;const n=`\n  if ("${e.pkg.name}" %in% loadedNamespaces()) {\n    detach("package:${e.pkg.name}", unload = TRUE)\n  }\n  remove.packages("${e.pkg.name}", lib="${e.pkg.libpath}")\n  `.trim(),r=(0,d.getObserver)("Error while uninstalling {0}: {1}",[e.pkg.name],(()=>(0,f.refreshPackages)(t)));l.runtime.executeCode("r",n,!0,void 0,l.RuntimeCodeExecutionMode.Interactive,void 0,r).then((()=>{(0,f.refreshPackages)(t).then((()=>{(t.getPackages?.()||[]).some((t=>t.name===e.pkg.name&&t.libpath===e.pkg.libpath))?s.window.showErrorMessage(s.l10n.t("Failed to uninstall {0} from {1}",e.pkg.name,e.pkg.libpath)):s.window.showInformationMessage(s.l10n.t("✅ Uninstalled {0}",e.pkg.name))})).catch((e=>{s.window.showErrorMessage(s.l10n.t("Error refreshing packages: {0}",e))}))}))},t.updatePackages=async function(e){await(0,f.refreshPackages)(e);const t=g.join(u.tmpdir(),`r_updates_${Date.now()}.json`),n=`\n    (function() {\n      jsonlite::write_json(\n        {\n          result <- do.call(rbind, lapply(.libPaths(), function(lib) {\n            pkgs <- old.packages(lib.loc = lib)\n            if (is.null(pkgs) || nrow(pkgs) == 0) return(NULL)\n    \n            data.frame(\n              Package = rownames(pkgs),\n              LibPath = lib,\n              Installed = pkgs[, "Installed"],\n              ReposVer = pkgs[, "ReposVer"],\n              stringsAsFactors = FALSE\n            )\n          }))\n    \n          if (is.null(result)) list() else result[order(result$Package, result$LibPath), ]\n        },\n        path = "${t.replace(/\\/g,"/")}",\n        auto_unbox = TRUE\n      )\n    })()\n    `.trim(),r=(0,d.getObserver)("Error while fetching updates: {0}",void 0,(()=>(0,f.refreshPackages)(e)));let a=[];if(await s.window.withProgress({location:s.ProgressLocation.Notification,title:s.l10n.t("Checking for R package updates..."),cancellable:!1},(async()=>{await l.runtime.executeCode("r",n,!1,void 0,l.RuntimeCodeExecutionMode.Silent,void 0,r);try{a=function(e){const t=c.readFileSync(e,"utf-8").trim();try{c.unlinkSync(e)}catch(e){console.warn(s.l10n.t("[Positron] Failed to delete temp file: "),e)}if("{}"===t||"[]"===t||"null"===t)return[];const n=JSON.parse(t);return Array.isArray(n)&&0!==n.length?n:[]}(t)}catch(e){a=null}})),!a)return void s.window.showErrorMessage(s.l10n.t("Failed to retrieve updatable packages."));if((0,d.getFilterRedundant)()){const t=e.getPackages?.()||[];a=a.filter((e=>!t.filter((t=>t.name===e.Package)).some((t=>t.version===e.ReposVer))))}if(0===a.length)return void s.window.showInformationMessage(s.l10n.t("✅ All R packages are up to date!"));const o=await async function(e){const t=e.map((e=>({label:`${e.Package}  (${e.Installed} → ${e.ReposVer})`,description:e.LibPath,picked:!0,...e})));return await s.window.showQuickPick(t,{title:s.l10n.t("Select R packages to update"),canPickMany:!0,placeHolder:s.l10n.t("Choose package installs to update"),ignoreFocusOut:!0})}(a);if(!o||0===o.length)return void s.window.showInformationMessage(s.l10n.t("No packages selected for update."));const i=o.map((e=>{const t=e.LibPath.replace(/\\/g,"/");return`install.packages("${e.Package}", lib = "${t}")`})).join("\n");await l.runtime.executeCode("r",i,!0,void 0,l.RuntimeCodeExecutionMode.Interactive),s.window.showInformationMessage(s.l10n.t("✅ Updated {0} R package(s) in-place",o.length)),(0,f.refreshPackages)(e)};const s=i(n(398)),l=i(n(346)),c=i(n(896)),u=i(n(857)),g=i(n(928)),f=n(75),d=n(185)},928:e=>{"use strict";e.exports=require("path")}},t={},n=function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}(265);module.exports=n})();